# ğŸ› ï¸ å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£æä¾›äº† Rust åç«¯é¡¹ç›®çš„è¯¦ç»†å¼€å‘æŒ‡å—ï¼ŒåŒ…æ‹¬é¡¹ç›®ç»“æ„ã€å¼€å‘å‘½ä»¤ã€é…ç½®ç®¡ç†ç­‰å†…å®¹ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
rust-backend/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main.rs              # åº”ç”¨å…¥å£ç‚¹
â”œâ”€â”€ crates/                  # Workspace æ¨¡å—
â”‚   â”œâ”€â”€ shared-lib/          # å…±äº«åº“
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ models/      # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ config.rs    # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ distributed_lock.rs
â”‚   â”œâ”€â”€ web-service/         # Web API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/      # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ services/    # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â””â”€â”€ models/      # Web å±‚æ¨¡å‹
â”‚   â”œâ”€â”€ consumer-service/    # æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹è€…
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ task_type_a.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ task_type_b.rs
â”‚   â”‚   â”‚   â””â”€â”€ redis_interaction.rs
â”‚   â”œâ”€â”€ cronjob-service/     # å®šæ—¶ä»»åŠ¡æœåŠ¡
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â””â”€â”€ jobs/        # å®šæ—¶ä»»åŠ¡å®šä¹‰
â”‚   â””â”€â”€ database/            # æ•°æ®åº“å±‚
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ models/      # æ•°æ®åº“æ¨¡å‹
â”‚       â”‚   â”œâ”€â”€ repositories/ # æ•°æ®è®¿é—®å±‚
â”‚       â”‚   â””â”€â”€ connection.rs
â”œâ”€â”€ migrations/              # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ db_helper/               # æœ¬åœ°å¼€å‘ç¯å¢ƒ
â”‚   â””â”€â”€ docker-compose.yml
â”œâ”€â”€ docs/                    # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ Cargo.toml              # é¡¹ç›®é…ç½®
```

## ğŸš€ å¼€å‘å‘½ä»¤

### åŸºç¡€å‘½ä»¤

```bash
# è¿è¡Œå¼€å‘æœåŠ¡å™¨
cargo run

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
cargo build --release

# ä»£ç æ£€æŸ¥
cargo check

# ä»£ç æ ¼å¼åŒ–
cargo fmt

# è¿è¡Œæµ‹è¯•
cargo test
```

### æ•°æ®åº“æ“ä½œ

```bash
# å¯åŠ¨æœ¬åœ°å¼€å‘ç¯å¢ƒ
cd db_helper && docker compose up -d

# å®‰è£… sqlx-cli (é¦–æ¬¡)
cargo install sqlx-cli

# åˆ›å»ºæ•°æ®åº“
sqlx database create

# è¿è¡Œè¿ç§»
sqlx migrate run

# åˆ›å»ºæ–°è¿ç§»
sqlx migrate add <migration_name>

# éªŒè¯ SQL æŸ¥è¯¢ (å¼€å‘æ—¶)
cargo install sqlx-cli --features postgres
```

## âš™ï¸ é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡é…ç½®

é¡¹ç›®ä½¿ç”¨ `dotenvy` ç®¡ç†ç¯å¢ƒå˜é‡ï¼Œæ”¯æŒ `.env` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://username:password@localhost:5432/rust_backend

# Redis é…ç½®
REDIS_URL=redis://localhost:6379

# åº”ç”¨é…ç½®
RUST_LOG=debug
APP_PORT=8080
```

### é…ç½®ç»“æ„

- `AppConfig` - åº”ç”¨ä¸»é…ç½®
- `DatabaseConfig` - æ•°æ®åº“é…ç½®
- `RedisConfig` - Redis é…ç½®

## ğŸ—„ï¸ æ•°æ®åº“å¼€å‘

### è¿ç§»ç³»ç»Ÿ

- ä½¿ç”¨ `sqlx` è¿ç§»ç³»ç»Ÿç®¡ç†æ•°æ®åº“ç‰ˆæœ¬
- è¿ç§»æ–‡ä»¶ä½äº `migrations/` ç›®å½•
- æ”¯æŒå‘ä¸Šå’Œå‘ä¸‹è¿ç§»

### æ•°æ®æ¨¡å‹

- åœ¨ `crates/database/src/models/` å®šä¹‰
- ä½¿ç”¨ `sqlx::FromRow` è‡ªåŠ¨æ˜ å°„
- æ”¯æŒå…³è”å…³ç³»å’ŒéªŒè¯

### ä»“å‚¨æ¨¡å¼

- `ProjectRepositoryTrait` å®šä¹‰æ•°æ®è®¿é—®æ¥å£
- å®ç°å…·ä½“çš„ CRUD æ“ä½œ
- æ”¯æŒäº‹åŠ¡å¤„ç†

## ğŸ“¨ æ¶ˆæ¯é˜Ÿåˆ—å¼€å‘

### Redis Streams

- ä½¿ç”¨ Redis Streams ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—
- æ”¯æŒæ¶ˆè´¹è€…ç»„å’Œæ¶ˆæ¯ç¡®è®¤
- è‡ªåŠ¨é‡è¯•å’Œé”™è¯¯å¤„ç†

### æ¶ˆè´¹è€…ç±»å‹

- `TaskTypeA` - A ç±»å‹æ¶ˆæ¯å¤„ç†å™¨
- `TaskTypeB` - B ç±»å‹æ¶ˆæ¯å¤„ç†å™¨
- æ”¯æŒå¹¶å‘å¤„ç†å’Œæ‰¹é‡æ“ä½œ

## ğŸŒ Web API å¼€å‘

### è·¯ç”±è®¾è®¡

- åŸºäº Axum çš„è·¯ç”±ç³»ç»Ÿ
- æ”¯æŒåµŒå¥—è·¯ç”±å’Œä¸­é—´ä»¶
- è‡ªåŠ¨ç”Ÿæˆ OpenAPI æ–‡æ¡£

### æœåŠ¡å±‚

- ä¸šåŠ¡é€»è¾‘ä¸è·¯ç”±åˆ†ç¦»
- ä½¿ç”¨ Trait è¿›è¡Œä¾èµ–æ³¨å…¥
- æ”¯æŒå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### é”™è¯¯å¤„ç†

- ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
- æ”¯æŒè‡ªå®šä¹‰é”™è¯¯ç±»å‹
- è‡ªåŠ¨ HTTP çŠ¶æ€ç æ˜ å°„

## ğŸ”„ å¼€å‘æµç¨‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd rust-backend

# å¯åŠ¨ä¾èµ–æœåŠ¡
cd db_helper && docker compose up -d
cd ..

# å®‰è£…æ•°æ®åº“å·¥å…·
cargo install sqlx-cli

# åˆå§‹åŒ–æ•°æ®åº“
sqlx database create
sqlx migrate run
```

### 2. å¼€å‘æ–°åŠŸèƒ½

1. **åˆ›å»ºåˆ†æ”¯**: `git checkout -b feature/new-feature`
2. **ç¼–å†™ä»£ç **: éµå¾ªé¡¹ç›®ä»£ç é£æ ¼
3. **è¿è¡Œæµ‹è¯•**: `cargo test`
4. **æ ¼å¼åŒ–ä»£ç **: `cargo fmt`
5. **æ£€æŸ¥ä»£ç **: `cargo clippy`
6. **æäº¤ä»£ç **: ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯

### 3. ä»£ç è§„èŒƒ

- **æ ¼å¼åŒ–**: ä½¿ç”¨ `cargo fmt` æ ¼å¼åŒ–ä»£ç 
- **ä»£ç æ£€æŸ¥**: ä½¿ç”¨ `cargo clippy` è¿›è¡Œé™æ€åˆ†æ
- **æµ‹è¯•**: ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- **æ–‡æ¡£**: æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ§ª æµ‹è¯•æŒ‡å—

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®š crate çš„æµ‹è¯•
cargo test -p <crate_name>

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test <test_name>
```

### é›†æˆæµ‹è¯•

```bash
# è¿è¡Œé›†æˆæµ‹è¯•
cargo test --test integration_tests

# éœ€è¦æ•°æ®åº“çš„æµ‹è¯•ï¼ˆç¡®ä¿æ•°æ®åº“å·²å¯åŠ¨ï¼‰
cargo test --test database_tests
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

```bash
# å¯åŠ¨å¼€å‘æ•°æ®åº“å’Œ Redis
cd db_helper
docker compose up -d

# è¿è¡Œåº”ç”¨
cargo run
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# æ„å»ºä¼˜åŒ–çš„ç”Ÿäº§ç‰ˆæœ¬
cargo build --release

# ä½¿ç”¨å¤šé˜¶æ®µæ„å»º Docker é•œåƒ
docker build -t rust-backend .
```

### ç¯å¢ƒé…ç½®

æœ¬åœ°å¼€å‘ç¯å¢ƒé…ç½®ç¤ºä¾‹ï¼š

```env
RUST_LOG=debug
DATABASE_URL=postgresql://username:password@localhost:5432/rust_backend
REDIS_URL=redis://localhost:6379
APP_PORT=8080
```

### ç›‘æ§å’Œæ—¥å¿—

- ä½¿ç”¨ `tracing` è¿›è¡Œç»“æ„åŒ–æ—¥å¿—è®°å½•
- æ”¯æŒæ—¥å¿—çº§åˆ«åŠ¨æ€è°ƒæ•´
- é›†æˆå¤–éƒ¨ç›‘æ§ç³»ç»Ÿ (Prometheus/Grafana)

## ğŸ“š ç›¸å…³èµ„æº

### ğŸ“‹ è¯¦ç»†æ–‡æ¡£

- **[æœåŠ¡ç”Ÿå‘½å‘¨æœŸ](./service-lifecycle.md)** - æ¶æ„è®¾è®¡å’Œä¼˜é›…å…³é—­æœºåˆ¶è¯¦è§£
- **[æ¶æ„æµç¨‹å›¾](./mermaid_final.md)** - å®Œæ•´çš„ç³»ç»Ÿæ¶æ„å¯è§†åŒ–å›¾è¡¨
- **[æŠ€æœ¯é€‰å‹ FAQ](./faq.md)** - ä¸ºä»€ä¹ˆé€‰æ‹©è¿™äº›æŠ€æœ¯æ ˆçš„è¯¦ç»†è¯´æ˜

---

*ğŸ¯ æœ¬æ–‡æ¡£ä¸º Rust åç«¯é¡¹ç›®çš„å®Œæ•´å¼€å‘æŒ‡å—ï¼Œæ¶µç›–äº†ä»ç¯å¢ƒæ­å»ºåˆ°ç”Ÿäº§éƒ¨ç½²çš„å…¨æµç¨‹ã€‚*